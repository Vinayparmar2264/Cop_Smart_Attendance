{% extends "layout.html" %}
{% block title %}Deleted Member Profile{% endblock %}

{% block content %}
<div class="px-4">
    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Archived Profile</h1>
                <p class="text-gray-600">This profile is for a member whose image data has been permanently deleted.</p>
            </div>
            <div>
                 <a href="{{ url_for('dashboard') }}" class="text-sm font-medium text-blue-600 hover:text-blue-500">&larr; Back to Dashboard</a>
            </div>
        </div>
    </div>

    <div id="member-profile-section" class="mt-8 bg-white p-6 rounded-lg shadow-md">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-gray-800">Member Details (Read-Only)</h2>
        </div>
        <div id="profile-table-container">
            <p class="text-center text-gray-500">Loading profile...</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const teamName = "{{ member_profile.team_name }}";
        const enrollmentId = "{{ member_profile.enrollment_id }}";

        // Fetch schema and profile data
        const [schemaResponse, profileResponse] = await Promise.all([
            fetch(`/api/get_member_profile_schema/${teamName}`),
            fetch(`/api/get_member_profile/${teamName}/${enrollmentId}`)
        ]);
        const schema = await schemaResponse.json();
        const profileData = await profileResponse.json();

        renderProfileTable(schema, profileData, false); // false = not editable
    });

    function renderProfileTable(schema, data, isEditable) {
        const container = document.getElementById('profile-table-container');
        if (!schema.fields) {
            container.innerHTML = '<p class="text-red-500">Could not load profile schema.</p>';
            return;
        }

        let content = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
        schema.fields.forEach(field => {
            const value = data[field.key] || 'N/A';
            content += `
                <div class="py-2">
                    <label class="block text-sm font-medium text-gray-500">${field.label}</label>
                    <p class="mt-1 text-sm text-gray-900">${value}</p>
                </div>
            `;
        });
        content += '</div>';
        container.innerHTML = content;
    }
</script>
{% endblock %}